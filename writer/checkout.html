<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Checkout || Witter Multipage Responsive Template</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
        <!-- Place favicon.ico in the root directory -->
        <!-- Google Fonts -->
		<link href='https://fonts.loli.net/css?family=Poppins:400,700,600,500,300' rel='stylesheet' type='text/css'>
		<!-- style css -->
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="../libs/layui/css/layer.css">
		<style type="text/css">
			.product-name {
				font-weight: normal;
			}
			.cart-price .check-price {
				font-weight: normal;
			}
		</style>
		<!-- modernizr css -->
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <!--Header Area Start-->
        <div class="header-area">
            <div class="container">
                <div class="row">
                    <div class="col-md-2 col-sm-6 col-xs-6">
                        <div class="header-logo">
                            <a href="index.html">
                                <img src="img/logo.png" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="col-md-1 col-sm-6 visible-sm  col-xs-6">
                        <div class="header-right">
                            <ul>
                                <li>
                                    <a href="my-account.html"><i class="flaticon-people"></i></a>
                                </li>
                                <li class="shoping-cart">
                                    <a href="cart.html" id="shopping-cart-num">
                                        <i class="flaticon-shop"></i>
                                        <!-- 显示购物车商品商量 -->
                                    </a>
                                    <div class="add-to-cart-product">
                                        <!-- 购物车商品展示 -->
                                        <div class="cart-product shopping-cart-book-area">
                                        </div>
                                        <div class="total-cart-price">
                                            <div class="cart-product-line fast-line">
                                                <span>运费</span>
                                                <span class="free-shiping">￥0</span>
                                            </div>
                                            <div class="cart-product-line">
                                                <span>合计</span>
                                                <span class="total total-amount"></span>
                                            </div>
                                        </div>
                                        <div class="cart-checkout">
                                            <a href="javascript:;">
                                                去结算
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>                    
                    <div class="col-md-9 col-sm-12 hidden-xs">
                        <div class="mainmenu text-center">
                            <nav>
                                <ul id="nav">
                                    <li><a href="index.html">首页</a></li>
                                    <li><a href="shop.html">精选</a></li>
                                    <li><a href="cart.html">购物车</a></li>
                                    <li><a href="order.html">订单</a></li>
                                    <li><a href="javascript:;">更多</a>
                                        <ul class="sub-menu">
                                            <li><a href="about.html">About Us</a></li>
                                            <li><a href="cart.html">Cart Page</a></li>
                                            <li><a href="checkout.html">Check Out</a></li>
                                            <li><a href="contact.html">Contact</a></li>
                                            <li><a href="my-account.html">My Account</a></li>
                                            <li><a href="shop.html">Shopping Page</a></li>
                                            <li><a href="single-product.html">Single Shop Page</a></li>
                                            <li><a href="wishlist.html">Wishlist Page</a></li>
                                    		<li><a href="login.html" class="isLogin">登录</a></li>
                                            <li><a href="javascript:;" class="isLogout" onClick="logout()">退出</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </nav>
                        </div>                        
                    </div>
                    <div class="col-md-1 hidden-sm">
                        <div class="header-right">
                            <ul>
                                <li>
                                    <a href="my-account.html"><i class="flaticon-people"></i></a>
                                </li>
                                <li class="shoping-cart">
                                    <a href="cart.html" id="shopping-cart-num">
                                        <i class="flaticon-shop"></i>
                                        <!-- 显示购物车商品商量 -->
                                    </a>
                                    <div class="add-to-cart-product">
                                        <!-- 购物车商品展示 -->
                                        <div class="cart-product shopping-cart-book-area">
                                        </div>
                                        <div class="total-cart-price">
                                            <div class="cart-product-line fast-line">
                                                <span>运费</span>
                                                <span class="free-shiping">￥0</span>
                                            </div>
                                            <div class="cart-product-line">
                                                <span>合计</span>
                                                <span class="total total-amount"></span>
                                            </div>
                                        </div>
                                        <div class="cart-checkout">
                                            <a href="javascript:;">
                                                去结算
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Header Area End-->
		<!-- Mobile Menu Start -->
		<div class="mobile-menu-area">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12">
						<div class="mobile-menu">
							<nav id="dropdown">
								<ul>
                                    <li><a href="index.html">HOME</a></li>
                                    <li><a href="shop.html">FEATURED</a></li>
                                    <li><a href="shop.html">REVIEW BOOK</a></li>
                                    <li><a href="about.html">ABOUT AUTHOR</a></li>
                                    <li><a href="#">pages</a>
                                        <ul>
                                            <li><a href="about.html">About Us</a></li>
                                            <li><a href="cart.html">Cart Page</a></li>
                                            <li><a href="checkout.html">Check Out</a></li>
                                            <li><a href="contact.html">Contact</a></li>
                                            <li><a href="login.html">Login</a></li>
                                            <li><a href="my-account.html">My Account</a></li>
                                            <li><a href="shop.html">Shopping Page</a></li>
                                            <li><a href="single-product.html">Single Shop Page</a></li>
                                            <li><a href="wishlist.html">Wishlist Page</a></li>
                                            <li><a href="404.html">404 Page</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="contact.html">CONTACT</a></li>
								</ul>
							</nav>
						</div>
					</div>
				</div>
			</div>
		</div>		
		<!-- Mobile Menu End -->   
        <!-- Breadcrumbs Area Start -->
        <div class="breadcrumbs-area">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
					    <div class="breadcrumbs">
					       <h2>Checkout List</h2> 
					       <ul class="breadcrumbs-list">
						        <li>
						            <a title="Return to Home" href="index.html">Home</a>
						        </li>
						        <li>Checkout List</li>
						    </ul>
					    </div>
					</div>
				</div>
			</div>
		</div> 
		<!-- Breadcrumbs Area Start --> 
        <!-- Check Out Area Start -->
        <div class="check-out-area section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
								<div class="panel-heading" role="tab" id="headingOne">
									<h4 class="panel-title">
										<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
										   <span>1</span>
										   地址信息
										</a>
									</h4>
								</div>
								<div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
									<div class="panel-body">
										<div class="row">
											<div class="col-md-12">
												<p class="form-row">
													<input type="text" placeholder="所在地区">
												</p>
											</div>
											<div class="col-md-12">
												<p class="form-row">
													<input type="text" id="shipp-address" placeholder="详细地址">
												</p>
											</div>
											<div class="col-md-12">
												<p class="form-row">
													<input type="text" id="phone" placeholder="手机号码 *">
												</p>
											</div>											
										</div>
									</div>
								</div>
                            </div>
                            <div class="panel panel-default">
								<div class="panel-heading" role="tab" id="headingTwo">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
										   <span>2</span>
										   支付方式
										</a>
									</h4>
								</div>
								<div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
									<div class="panel-body no-padding">
										<div class="payment-met">
											<form action="#" id="payment-form">
												<ul class="form-list">
													<li class="control">
														<input type="radio" class="radio" title="支付宝" name="payment[method]" id="p_method_checkmo" checked="checked">
														<label for="p_method_checkmo">支付宝 </label>
													</li>
													<li class="control">
														<input type="radio" class="radio" title="微信支付" name="payment[method]" id="p_method_ccsave">
														<label for="p_method_ccsave">微信支付 </label>
													</li>
												</ul>
											</form>
										</div>
									</div>
								</div>
							</div>
							<div class="panel panel-default">
								<div class="panel-heading" role="tab" id="headingThree">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
										   <span>3</span>
										   确认订单
										</a>
									</h4>
								</div>
								<div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
									<div class="panel-body no-padding">
										<div class="order-review" id="checkout-review">    
											<div class="table-responsive" id="checkout-review-table-wrapper">
												<table class="data-table" id="checkout-review-table">
													<thead>
														<tr>
															<th rowspan="1">名称</th>
															<th colspan="1">单价</th>
															<th rowspan="1">数量</th>
															<th colspan="1">小计</th>
														</tr>
													</thead>
													<tbody id="productlist">
														<!-- 订单tr信息 -->
													</tbody>
													<tfoot>
														<tr>
															<td colspan="3">商品金额</td>
															<td><span>￥</span><span class="check-price" id="product-amount"></span></td>
														</tr>
														<tr>
															<td colspan="3">运费</td>
															<td><span class="check-price">￥0</span></td>
														</tr>
														<tr>
															<td colspan="3"><strong>合计</strong></td>
															<td><strong>￥<span class="check-price" id="product-total-amount"></span></strong></td>
														</tr>
													</tfoot>
												</table>
											</div>
											<div id="checkout-review-submit">
												<div class="cart-btn-3" id="review-buttons-container">
													<p class="left"></p>
													<button title="Place Order" class="btn btn-default" onClick="placeOrder()"><span>提交订单</span></button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
                        </div>
                    </div>
                    <div class="col-md-offset-1 col-md-3">
                        <div class="checkout-widget">
                            <h2 class="widget-title">结账进度</h2>
                            <ul>
								<li><a><i class="fa fa-minus"></i> 地址信息</a></li>
								<li><a><i class="fa fa-minus"></i> 支付方式</a></li>
								<li><a><i class="fa fa-minus"></i> 确认订单</a></li>
							</ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Check Out Area End -->
		<!-- Footer Area Start -->
		<footer>
		    <div class="footer-top-area">
		        <div class="container">
		            <div class="row">
		                <div class="col-md-3 col-sm-8">
		                    <div class="footer-left">
		                        <a href="index.html">
		                            <img src="img/logo-2.png" alt="">
		                        </a>
		                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore.</p>
		                        <ul class="footer-contact">
		                            <li>
		                                <i class="flaticon-location"></i>
		                                450 fifth Avenue, 34th floor. NYC
		                            </li>
		                            <li>
		                                <i class="flaticon-technology"></i>
		                                (+800) 123 4567 890
		                            </li>
		                            <li>
		                                <i class="flaticon-web"></i>
		                                info@bookstore.com
		                            </li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 col-sm-4">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Information</h2>
		                        <ul class="footer-list">
		                            <li><a href="about.html">About Us</a></li>
		                            <li><a href="#">Delivery Information</a></li>
		                            <li><a href="#">Privacy & Policy</a></li>
		                            <li><a href="#">Terms & Conditions</a></li>
		                            <li><a href="#">Manufactures</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 hidden-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">My Account</h2>
		                        <ul class="footer-list">
		                            <li><a href="my-account.html">My Account</a></li>
		                            <li><a href="login.html">Login</a></li>
		                            <li><a href="cart.html">My Cart</a></li>
		                            <li><a href="wishlist.html">Wishlist</a></li>
		                            <li><a href="checkout.html">Checkout</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 hidden-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Shop</h2>
		                        <ul class="footer-list">
		                            <li><a href="#">Orders & Returns</a></li>
		                            <li><a href="#">Search Terms</a></li>
		                            <li><a href="#">Advance Search</a></li>
		                            <li><a href="#">Affiliates</a></li>
		                            <li><a href="#">Group Sales</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-3 col-sm-8">
		                    <div class="single-footer footer-newsletter">
		                        <h2 class="footer-title">Our Newsletter</h2>
		                        <p>Consectetur adipisicing elit se do eiusm od tempor incididunt ut labore et dolore magnas aliqua.</p>
		                        <form action="#" method="post">
		                            <div>
		                                <input type="text" placeholder="email address">
		                            </div>
		                            <button class="btn btn-search btn-small" type="submit">SUBSCRIBE</button>
		                            <i class="flaticon-networking"></i>
		                        </form>
		                        <ul class="social-icon">
		                            <li>
		                                <a href="#">
		                                    <i class="flaticon-social"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="#">
		                                    <i class="flaticon-social-1"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="#">
		                                    <i class="flaticon-social-2"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="#">
		                                    <i class="flaticon-video"></i>
		                                </a>
		                            </li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 col-sm-4 visible-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Shop</h2>
		                        <ul class="footer-list">
		                            <li><a href="#">Orders & Returns</a></li>
		                            <li><a href="#">Search Terms</a></li>
		                            <li><a href="#">Advance Search</a></li>
		                            <li><a href="#">Affiliates</a></li>
		                            <li><a href="#">Group Sales</a></li>
		                        </ul>
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="footer-bottom">
		        <div class="container">
		            <div class="row">
		                <div class="col-md-6">
                            <div class="footer-bottom-left pull-left">
                                <p>Copyright &copy; 2016 <span><a href="#">8m2</a></span>. All Right Reserved.</p>
                            </div>
		                </div>
		                <div class="col-md-6">
		                    <div class="footer-bottom-right pull-right">
		                        <img src="img/paypal.png" alt="">
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		</footer>
		<!-- Footer Area End -->
		<!-- all js here -->
		<!-- jquery latest version -->
        <script src="js/vendor/jquery-1.12.0.min.js"></script>
		<!-- bootstrap js -->
        <script src="js/bootstrap.min.js"></script>
		<!-- owl.carousel js -->
        <script src="js/owl.carousel.min.js"></script>
		<!-- jquery-ui js -->
        <script src="js/jquery-ui.min.js"></script>
		<!-- jquery Counterup js -->
        <script src="js/jquery.counterup.min.js"></script>
        <script src="js/waypoints.min.js"></script>	
		<!-- jquery countdown js -->
        <script src="js/jquery.countdown.min.js"></script>
		<!-- jquery countdown js -->
        <script type="text/javascript" src="venobox/venobox.min.js"></script>
		<!-- jquery Meanmenu js -->
        <script src="js/jquery.meanmenu.js"></script>
		<!-- wow js -->
        <script src="js/wow.min.js"></script>	
		<script>
			new WOW().init();
		</script>
		<!-- scrollUp JS -->		
        <script src="js/jquery.scrollUp.min.js"></script>
		<!-- plugins js -->
        <script src="js/plugins.js"></script>
		<!-- Nivo slider js -->
		<script src="lib/js/jquery.nivo.slider.js" type="text/javascript"></script>
		<script src="lib/home.js" type="text/javascript"></script>
		<!-- main js -->
        <script src="js/main.js"></script>
		<script src="../libs/layui/layer.js"></script>
		<script type="text/javascript" src="../js/app.js"></script>
		<script>
			var userToken = window.localStorage.getItem('userToken')
			// 显示登录退出标签
			showIsLogout()
			function showIsLogout() {
				if (userToken) {
					$('.isLogout').show()
					$('.isLogin').hide()
				} else {
					$('.isLogout').hide()
					$('.isLogin').show()
				}
			}
			
			function logout() {
				$.ajax({
					url: url.user.logout,
					headers: {
						token: userToken
					},
					type: 'GET',
					dataType: 'json',
					success: function(resp) {
						console.log(resp)
						window.localStorage.removeItem('userToken')
						window.location.href = 'login.html'
					}
				})
			}
			
			// 从内存中获取购物车信息，初始化订单
			var orderInsertBO = new Object()
			var totalQuantity = 0
			var totalAmount = 0
			initCheckout()
			
			function initCheckout() {
				if (userToken == null) {
					layer.msg('请先登录')
					return
				}
				var bookIds = window.localStorage.getItem('checkout:' + userToken)
				if (bookIds != null && bookIds != '') {
					$.ajax({
						url: url.cart.getByBookIds,
						data: {bookIds: bookIds},
						headers: {
							token: userToken
						},
						type: 'GET',
						dataType: 'json',
						success: function(resp) {
							if (resp.code != null && resp.code == 200 && resp.data != null) {
								var orderBookInsertBOs = []
								var html = ''
								$.each(resp.data, function(i, v) {
									var orderBookInsertBO = new Object()
									orderBookInsertBO.bookId = v.bookIdStr
									orderBookInsertBO.quantity = v.quantity
									orderBookInsertBO.amount = v.amount
									orderBookInsertBOs.push(orderBookInsertBO)
									totalQuantity += v.quantity
									totalAmount += v.amount * 100
									html += '<tr>' +
												'<td><h4 class="product-name" style="font-weight: normal;">' + v.book.name + '</h4></td>' +
												'<td><span class="cart-price">￥<span class="check-price">' + v.book.sellingPrice + '</span></span></td>' +
												'<td>' + v.quantity + '</td>' +
												'<td><span class="cart-price">￥<span class="check-price">' + v.amount + '</span></span></td>' +
											'</tr>';
								})
								$('#productlist').html(html)
								$('#product-amount').html(totalAmount / 100)
								$('#product-total-amount').html(totalAmount / 100)
								orderInsertBO.orderBookInsertBOs = orderBookInsertBOs
							} else {
								layer.msg(resp.msg)
							}
						},
						error: function(e) {
							if (e.responseJSON != null) {
								layer.msg(e.responseJSON.msg)
							} else {
								layer.msg('服务器未启动')
							}
						}
					})
				}
			}
			
			/**
			 * 下订单
			 */
			function placeOrder() {
				if (userToken == null) {
					layer.msg('请先登录')
					return
				}
				
				orderInsertBO.shippingAddress = $('#shipp-address').val()
				orderInsertBO.totalQuantity = totalQuantity
				orderInsertBO.totalAmount = totalAmount / 100
				$.ajax({
					url: url.order.add,
					data: JSON.stringify(orderInsertBO),
					headers: {
						token: userToken
					},
					type: 'POST',
					dataType: 'json',
					contentType: 'application/json',
					success: function(resp) {
						layer.msg(resp.msg)
					},
					error: function(e) {
						if (e.responseJSON != null) {
							layer.msg(e.responseJSON.msg)
						} else {
							layer.msg('服务器未启动')
						}
					}
				})
			}
		</script>
</html>
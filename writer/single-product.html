<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Product Details</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
        <!-- Place favicon.ico in the root directory -->
        <!-- Google Fonts -->
		<link href='https://fonts.loli.net/css?family=Poppins:400,700,600,500,300' rel='stylesheet' type='text/css'>
		<!-- style css -->
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="../libs/layui/css/layer.css">
		<style type="text/css">
			.pic-content {
				display: flex;
				justify-content: center;
			}
			.tit span {
				font-size: 16px;
				color: #333;
				font-family: 'Microsoft YaHei';
				height: 32px;
				border: 1px solid #e9e9e9;
				background-color: #f5f5f5;
				font-weight: normal;
				text-align: center;
				line-height: 32px;
				padding: 0 10px;
			}
			.single-product-price h2 {
				color: #e60000;
			}
			.book-detail {
				display: flex;
				justify-content: center;
			}
			.qtybutton {
				-moz-user-select:none;/*火狐*/
				-webkit-user-select:none;/*webkit浏览器*/
				-ms-user-select:none;/*IE10*/
				-khtml-user-select:none;/*早期浏览器*/
				user-select:none;	
			}
		</style>
		<!-- modernizr css -->
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <!--Header Area Start-->
        <div class="header-area">
            <div class="container">
                <div class="row">
                    <div class="col-md-2 col-sm-6 col-xs-6">
                        <div class="header-logo">
                            <a href="index.html">
                                <img src="img/logo.png" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="col-md-1 col-sm-6 visible-sm  col-xs-6">
                        <div class="header-right">
                            <ul>
                                <li>
                                    <a href="my-account.html"><i class="flaticon-people"></i></a>
                                </li>
                                <li class="shoping-cart">
                                    <a href="javascript:;">
                                        <i class="flaticon-shop"></i>
                                        <span>2</span>
                                    </a>
                                    <div class="add-to-cart-product">
                                        <div class="cart-product">
                                            <div class="cart-product-image">
                                                <a href="single-product.html">
                                                    <img src="img/shop/1.jpg" alt="">
                                                </a>
                                            </div>
                                            <div class="cart-product-info">
                                                <p>
                                                    <span>1</span>
                                                    x
                                                    <a href="single-product.html">East of eden</a>
                                                </p>
                                                <a href="single-product.html">S, Orange</a>
                                                <span class="cart-price">$ 140.00</span>
                                            </div>
                                            <div class="cart-product-remove">
                                                <i class="fa fa-times"></i>
                                            </div>
                                        </div>
                                        <div class="cart-product">
                                            <div class="cart-product-image">
                                                <a href="single-product.html">
                                                    <img src="img/shop/1.jpg" alt="">
                                                </a>
                                            </div>
                                            <div class="cart-product-info">
                                                <p>
                                                    <span>1</span>
                                                    x
                                                    <a href="single-product.html">East of eden</a>
                                                </p>
                                                <a href="single-product.html">S, Orange</a>
                                                <span class="cart-price">$ 140.00</span>
                                            </div>
                                            <div class="cart-product-remove">
                                                <i class="fa fa-times"></i>
                                            </div>
                                        </div>
                                        <div class="total-cart-price">
                                            <div class="cart-product-line fast-line">
                                                <span>Shipping</span>
                                                <span class="free-shiping">$10.50</span>
                                            </div>
                                            <div class="cart-product-line">
                                                <span>Total</span>
                                                <span class="total">$ 140.00</span>
                                            </div>
                                        </div>
                                        <div class="cart-checkout">
                                            <a href="checkout.html">
                                                Check out
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>                    
                    <div class="col-md-9 col-sm-12 hidden-xs">
                        <div class="mainmenu text-center">
                            <nav>
                                <ul id="nav">
                                    <li><a href="index.html">首页</a></li>
                                    <li><a href="shop.html">精选</a></li>
                                    <li><a href="cart.html">购物车</a></li>
                                    <li><a href="order.html">订单</a></li>
                                    <li><a href="javascript:;">更多</a>
                                        <ul class="sub-menu">
                                            <li><a href="about.html">About Us</a></li>
                                            <li><a href="cart.html">Cart Page</a></li>
                                            <li><a href="checkout.html">Check Out</a></li>
                                            <li><a href="contact.html">Contact</a></li>
                                            <li><a href="my-account.html">My Account</a></li>
                                            <li><a href="shop.html">Shopping Page</a></li>
                                            <li><a href="single-product.html">Single Shop Page</a></li>
                                            <li><a href="wishlist.html">Wishlist Page</a></li>
                                    		<li><a href="login.html" class="isLogin">登录</a></li>
                                            <li><a href="javascript:;" class="isLogout" onClick="logout()">退出</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </nav>
                        </div>                        
                    </div>
                    <div class="col-md-1 hidden-sm">
                        <div class="header-right">
                            <ul>
                                <li>
                                    <a href="my-account.html"><i class="flaticon-people"></i></a>
                                </li>
                                <li class="shoping-cart">
                                    <a href="cart.html" id="shopping-cart-num">
                                        <i class="flaticon-shop"></i>
                                        <!-- 显示购物车商品商量 -->
                                    </a>
                                    <div class="add-to-cart-product">
                                        <!-- 购物车商品展示 -->
										<div class="shopping-cart-book-area">
										</div>
                                        <div class="total-cart-price">
                                            <div class="cart-product-line fast-line">
                                                <span>运费</span>
                                                <span class="free-shiping">￥0</span>
                                            </div>
                                            <div class="cart-product-line">
                                                <span>合计</span>
                                                <span class="total total-amount"></span>
                                            </div>
                                        </div>
                                        <div class="cart-checkout">
                                            <a href="checkout.html">
                                                去结算
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Header Area End-->
		<!-- Mobile Menu Start -->
		<div class="mobile-menu-area">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12">
						<div class="mobile-menu">
							<nav id="dropdown">
								<ul>
                                    <li><a href="index.html">HOME</a></li>
                                    <li><a href="shop.html">FEATURED</a></li>
                                    <li><a href="shop.html">REVIEW BOOK</a></li>
                                    <li><a href="about.html">ABOUT AUTHOR</a></li>
                                    <li><a href="javascript:;">pages</a>
                                        <ul>
                                            <li><a href="about.html">About Us</a></li>
                                            <li><a href="cart.html">Cart Page</a></li>
                                            <li><a href="checkout.html">Check Out</a></li>
                                            <li><a href="contact.html">Contact</a></li>
                                            <li><a href="login.html">Login</a></li>
                                            <li><a href="my-account.html">My Account</a></li>
                                            <li><a href="shop.html">Shopping Page</a></li>
                                            <li><a href="single-product.html">Single Shop Page</a></li>
                                            <li><a href="wishlist.html">Wishlist Page</a></li>
                                            <li><a href="404.html">404 Page</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="contact.html">CONTACT</a></li>
								</ul>
							</nav>
						</div>
					</div>
				</div>
			</div>
		</div>		
		<!-- Mobile Menu End -->   
        <!-- Breadcrumbs Area Start -->
        <div class="breadcrumbs-area">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
					    <div class="breadcrumbs">
					       <h2>PRODUCT DETAILS</h2> 
					       <ul class="breadcrumbs-list">
						        <li>
						            <a title="Return to Home" href="index.html">Home</a>
						        </li>
						        <li>Product Details</li>
						    </ul>
					    </div>
					</div>
				</div>
			</div>
		</div> 
		<!-- Breadcrumbs Area Start --> 
        <!-- Single Product Area Start -->
        <div class="single-product-area section-padding">
            <div class="container">
                <div class="row single-book-info">
                    <!-- 书籍信息 -->
                </div>
                <div class="row book-detail">
					<div class="col-md-9">
                        <div class="p-details-tab-content">
                            <div class="p-details-tab">
                                <ul class="p-details-nav-tab" role="tablist">
                                    <li role="presentation" class="active"><a href="#preface" aria-controls="preface" role="tab" data-toggle="tab">前言</a></li>
                                    <li role="presentation"><a href="#catalog" aria-controls="catalog" role="tab" data-toggle="tab">目录</a></li>
                                    <li role="presentation"><a href="#excerpt" aria-controls="excerpt" role="tab" data-toggle="tab">节选</a></li>
                                </ul>
                            </div>
                            <div class="clearfix"></div>
                            <div class="tab-content review">
                                <div role="tabpanel" class="tab-pane preface active" id="preface">
                                </div>
                                <div role="tabpanel" class="tab-pane catalog" id="catalog">
                                </div>
                                <div role="tabpanel" class="tab-pane excerpt" id="excerpt">
                                </div>
                            </div>
                        </div>
					</div>
				</div>  
            </div>
        </div>
        <!-- Single Product Area End -->
        <!-- Related Product Area Start -->
        <div class="related-product-area">
            <h2 class="section-title">相似推荐</h2>
            <div class="container">
                <div class="row">
                    <div class="related-product indicator-style">
                        
                    </div>
                </div>
            </div>
        </div>
        <!-- Related Product Area End -->
		<!-- Footer Area Start -->
		<footer>
		    <div class="footer-top-area">
		        <div class="container">
		            <div class="row">
		                <div class="col-md-3 col-sm-8">
		                    <div class="footer-left">
		                        <a href="index.html">
		                            <img src="img/logo-2.png" alt="">
		                        </a>
		                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore.</p>
		                        <ul class="footer-contact">
		                            <li>
		                                <i class="flaticon-location"></i>
		                                450 fifth Avenue, 34th floor. NYC
		                            </li>
		                            <li>
		                                <i class="flaticon-technology"></i>
		                                (+800) 123 4567 890
		                            </li>
		                            <li>
		                                <i class="flaticon-web"></i>
		                                info@bookstore.com
		                            </li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 col-sm-4">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Information</h2>
		                        <ul class="footer-list">
		                            <li><a href="about.html">About Us</a></li>
		                            <li><a href="javascript:;">Delivery Information</a></li>
		                            <li><a href="javascript:;">Privacy & Policy</a></li>
		                            <li><a href="javascript:;">Terms & Conditions</a></li>
		                            <li><a href="javascript:;">Manufactures</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 hidden-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">My Account</h2>
		                        <ul class="footer-list">
		                            <li><a href="my-account.html">My Account</a></li>
		                            <li><a href="login.html">Login</a></li>
		                            <li><a href="cart.html">My Cart</a></li>
		                            <li><a href="wishlist.html">Wishlist</a></li>
		                            <li><a href="checkout.html">Checkout</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 hidden-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Shop</h2>
		                        <ul class="footer-list">
		                            <li><a href="javascript:;">Orders & Returns</a></li>
		                            <li><a href="javascript:;">Search Terms</a></li>
		                            <li><a href="javascript:;">Advance Search</a></li>
		                            <li><a href="javascript:;">Affiliates</a></li>
		                            <li><a href="javascript:;">Group Sales</a></li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-3 col-sm-8">
		                    <div class="single-footer footer-newsletter">
		                        <h2 class="footer-title">Our Newsletter</h2>
		                        <p>Consectetur adipisicing elit se do eiusm od tempor incididunt ut labore et dolore magnas aliqua.</p>
		                        <div>
		                            <div>
		                                <input type="text" placeholder="email address">
		                            </div>
		                            <button class="btn btn-search btn-small">SUBSCRIBE</button>
		                            <i class="flaticon-networking"></i>
		                        </div>
		                        <ul class="social-icon">
		                            <li>
		                                <a href="javascript:;">
		                                    <i class="flaticon-social"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="javascript:;">
		                                    <i class="flaticon-social-1"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="javascript:;">
		                                    <i class="flaticon-social-2"></i>
		                                </a>
		                            </li>
		                            <li>
		                                <a href="javascript:;">
		                                    <i class="flaticon-video"></i>
		                                </a>
		                            </li>
		                        </ul>
		                    </div>
		                </div>
		                <div class="col-md-2 col-sm-4 visible-sm">
		                    <div class="single-footer">
		                        <h2 class="footer-title">Shop</h2>
		                        <ul class="footer-list">
		                            <li><a href="javascript:;">Orders & Returns</a></li>
		                            <li><a href="javascript:;">Search Terms</a></li>
		                            <li><a href="javascript:;">Advance Search</a></li>
		                            <li><a href="javascript:;">Affiliates</a></li>
		                            <li><a href="javascript:;">Group Sales</a></li>
		                        </ul>
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="footer-bottom">
		        <div class="container">
		            <div class="row">
		                <div class="col-md-6">
                            <div class="footer-bottom-left pull-left">
                                <p>Copyright &copy; 2016 <span><a href="javascript:;">8m2</a></span>. All Right Reserved.</p>
                            </div>
		                </div>
		                <div class="col-md-6">
		                    <div class="footer-bottom-right pull-right">
		                        <img src="img/paypal.png" alt="">
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		</footer>
		<!-- Footer Area End -->
		<!-- all js here -->
		<!-- jquery latest version -->
        <script src="js/vendor/jquery-1.12.0.min.js"></script>
		<!-- bootstrap js -->
        <script src="js/bootstrap.min.js"></script>
		<!-- owl.carousel js -->
        <script src="js/owl.carousel.min.js"></script>
		<!-- jquery-ui js -->
        <script src="js/jquery-ui.min.js"></script>
		<!-- jquery Counterup js -->
        <script src="js/jquery.counterup.min.js"></script>
        <script src="js/waypoints.min.js"></script>	
		<!-- jquery countdown js -->
        <script src="js/jquery.countdown.min.js"></script>
		<!-- jquery countdown js -->
        <script type="text/javascript" src="venobox/venobox.min.js"></script>
		<!-- jquery Meanmenu js -->
        <script src="js/jquery.meanmenu.js"></script>
		<!-- wow js -->
        <script src="js/wow.min.js"></script>	
		<script>
			new WOW().init();
		</script>
		<!-- scrollUp JS -->		
        <script src="js/jquery.scrollUp.min.js"></script>
		<!-- plugins js -->
        <script src="js/plugins.js"></script>
		<!-- Nivo slider js -->
		<script src="lib/js/jquery.nivo.slider.js" type="text/javascript"></script>
		<script src="lib/home.js" type="text/javascript"></script>
		<!-- main js -->
        <script src="js/main.js"></script>
		<script src="../libs/layui/layer.js"></script>
		<script type="text/javascript" src="../js/app.js"></script>
		<script>
			var id = getUrlParam('id')
			var classification = 0
			initBook(id)
			checkCart()
			
			// 显示登录退出标签
			showIsLogout()
			function showIsLogout() {
				var userToken = window.localStorage.getItem('userToken')
				if (userToken) {
					$('.isLogout').show()
					$('.isLogin').hide()
				} else {
					$('.isLogout').hide()
					$('.isLogin').show()
				}
			}
			
			function logout() {
				var userToken = window.localStorage.getItem('userToken')
				$.ajax({
					url: url.user.logout,
					headers: {
						token: userToken
					},
					type: 'GET',
					dataType: 'json',
					success: function(resp) {
						console.log(resp)
						window.localStorage.removeItem('userToken')
						window.location.href = 'login.html'
					}
				})
			}
			
			/**
			 * 从url获取参数值
			 * @param {Object} url参数
			 */
			function getUrlParam(param) {
				var reg = new RegExp("(^|&)" + param + "=([^&]*)(&|$)")
				var r = window.location.search.substr(1).match(reg)
				if (r != null) return unescape(r[2]); return null;
			}
			
			function initBook(id) {
				$.ajax({
					url: url.book.getById + "/" + id,
					type: 'GET',
					dataType: 'json',
					success: function(resp) {
						if (resp.code != null && resp.code == 200 && resp.data != null) {
							var book = resp.data
							$('title').html(book.name)
							classification = book.classification
							var html = '<div class="col-md-6 col-sm-7">' +
									'<div class="single-product-image-inner">' +
										'<div class="tab-content pic-content">' +
											'<div role="tabpanel" class="tab-pane active" id="one">' +
												'<a class="venobox" data-gall="gallery" title="">' +
													'<img src="' + book.picUrl + '" alt="">' +
												'</a>' +
											'</div>' +
										'</div>' +
									'</div>' +
								'</div>' +
								'<div class="col-md-6 col-sm-5">' +
									'<div class="single-product-details">' +
										'<div class="list-pro-rating">' +
											'<i class="fa fa-star icolor"></i>' +
											'<i class="fa fa-star icolor"></i>' +
											'<i class="fa fa-star icolor"></i>' +
											'<i class="fa fa-star icolor"></i>' +
											'<i class="fa fa-star"></i>' +
										'</div>' +
										'<h2>' + book.name + '</h2>' +
										'<p>' + book.brief + '</p>' +
										'<div class="single-product-price">' +
											'<h2>￥' + book.sellingPrice + '</h2>' +
										'</div>' +
										'<div class="product-attributes clearfix">' +
											'<span class="pull-left" id="quantity-wanted-p">' +
												'<span class="dec qtybutton">-</span>' +
												'<input type="text" value="1" class="cart-plus-minus-box">' +
												'<span class="inc qtybutton">+</span>' +
											'</span>' +
										   '<span>' +
												'<a href="javascript:;" class="cart-btn btn-default" onClick="addCart()">' +
													'<i class="flaticon-shop"></i>' +
													'加入购物车' +
												'</a>' +
										   '</span>' +
										'</div>' +
										'<div class="add-to-wishlist">' +
											'<a href="javascript:;" class="wish-btn">' +
												'<i class="fa fa-heart-o"></i>' +
												'&nbsp;收藏' +
											'</a>' +
										'</div>' +
										'<div class="single-product-categories">' +
										   '<label>所属分类:&nbsp;&nbsp;</label>' +
											'<span>' + book.classificationStr + '&nbsp;>&nbsp;' + book.categoryStr + '</span>' +
										'</div>' +
									'</div>' +
								'</div>';
							$('.single-book-info').append(html)
							$('.preface').append(book.preface)
							$('.catalog').append(book.catalog)
							$('.excerpt').append(book.excerpt)
							qtyButtonBind()
							similarRecommended()
						} else {
							layer.msg(resp.msg)
						}
					},
					error: function(e) {
						if (e.responseJSON != null) {
							layer.msg(e.responseJSON.msg)
						} else {
							layer.msg('服务器未启动')
						}
					}
				})
			}
			
			/**
			 * 加载同类书籍
			 */
			function similarRecommended() {
				$.ajax({
					url: url.book.getSimilarRecommended + "/" + classification,
					type: 'GET',
					dataType: 'json',
					success: function(resp) {
						if (resp.code != null && resp.code == 200 && resp.data != null) {
							var html = '';
							$.each(resp.data, function(i, v) {
								html += '<div class="col-md-3">' +
									    '<div class="single-banner">' +
									        '<div class="product-wrapper">' +
									            '<a class="single-banner-image-wrapper">' +
									                '<img alt="" src="' + v.picUrl + '">' +
									                '<div class="price"><span>￥</span>' + v.sellingPrice + '</div>' +
									                '<div class="rating-icon">' +
									                    '<i class="fa fa-star icolor"></i>' +
									                    '<i class="fa fa-star icolor"></i>' +
									                    '<i class="fa fa-star icolor"></i>' +
									                    '<i class="fa fa-star icolor"></i>' +
									                    '<i class="fa fa-star"></i>' +
									                '</div>' +
									            '</a>' +
									            '<div class="product-description">' +
									                '<div class="functional-buttons">' +
									                    '<a href="javascript:;" title="加入购物车" onClick="addOneToCart(\'' + v.idStr + '\')">' +
									                        '<i class="fa fa-shopping-cart"></i>' +
									                    '</a>' +
									                    '<a href="javascript:;" title="收藏">' +
									                        '<i class="fa fa-heart-o"></i>' +
									                    '</a>' +
									                    '<a href="single-product.html?id=' + v.idStr + '" title="查看详情">' +
									                        '<i class="fa fa-expand"></i>' +
									                    '</a>' +
									                '</div>' +
									            '</div>' +
									        '</div>' +
									        '<div class="bottom-book-title text-center">' +
									            '<a href="single-product.html?id=' + v.idStr + '">' + v.name + '</a>' +
									        '</div>' +
									    '</div>' +
									'</div>';
							});
							$('.related-product').append(html);
							$(".related-product").owlCarousel({
								autoPlay: false,
								slideSpeed:2000,
								pagination:false,
								navigation:true,	  
								items : 4,
								/* transitionStyle : "fade", */    /* [This code for animation ] */
								navigationText:["<i class='fa fa-angle-left'></i>","<i class='fa fa-angle-right'></i>"],
								itemsDesktop : [1199,3],
								itemsDesktopSmall : [991,3],
								itemsTablet: [767,2],
								itemsMobile : [479,1]
							})
						} else {
							layer.msg(resp.msg)
						}
					},
					error: function(e) {
						if (e.responseJSON != null) {
							layer.msg(e.responseJSON.msg)
						} else {
							layer.msg('服务器未启动')
						}
					}
				})
			}
			
			/**
			 * 绑定+-按钮点击事件
			 */
			function qtyButtonBind() {
				// $(".cart-plus-minus").append('<div class="dec qtybutton">-</div><div class="inc qtybutton">+</div>');
				$(".qtybutton").on("click", function() {
				    var $button = $(this);
				    var oldValue = $button.parent().find("input").val();
				    if ($button.text() == "+") {
				        var newVal = parseFloat(oldValue) + 1;
				    } else {
				        // Don't allow decrementing below zero
				        if (oldValue > 0) {
				            var newVal = parseFloat(oldValue) - 1;
				        } else {
				            newVal = 0;
				        }
				    }
				    $button.parent().find("input").val(newVal);
				});
			}
			
			/**
			 * 加入购物车
			 */
			function addCart() {
				 var userToken = window.localStorage.getItem('userToken')
				 var quantity = $('.cart-plus-minus-box').val()
				 if (userToken == null) {
					 layer.msg('会话失效，请重新登录', function() {
					 	window.localStorage.removeItem('userToken')
					 	window.location.href = 'login.html'
					 }, {time: 2000})
					 return false
				 } else if (quantity < 1) {
					 layer.msg('商品数量不能小于1')
				 } else {
					 addCartAjax(id, quantity, userToken)
				 }
			}
			
			function addOneToCart(bookId) {
				var userToken = window.localStorage.getItem('userToken')
				if (userToken == null) {
					layer.msg('会话失效，请重新登录', function() {
						window.localStorage.removeItem('userToken')
						window.location.href = 'login.html'
					}, {time: 2000})
					return false
				} else {
					addCartAjax(bookId, 1, userToken)
				}
			}
			
			function addCartAjax(bookId, quantity, userToken) {
				$.ajax({
					url: url.cart.add,
					data: JSON.stringify({
						bookId: bookId,
						quantity: quantity
					}),
					headers: {
						token: userToken
					},
					contentType: 'application/json',
					type: 'POST',
					dataType: 'json',
					success: function(resp) {
						if (resp.code != null && resp.code == 200) {
							layer.msg('商品已成功加入购物车')
							checkCart()
						}
					},
					error: function(e) {
						if (e.responseJSON != null) {
							layer.msg(e.responseJSON.msg)
						} else {
							layer.msg('服务器未启动')
						}
					}
				})
			}
			
			/**
			 * 查看购物车
			 */
			function checkCart() {
				var userToken = window.localStorage.getItem('userToken')
				if (userToken == null) return
				var html = ''
				if (userToken != null) {
					$.ajax({
						url: url.cart.get,
						headers: {
							token: userToken
						},
						type: 'GET',
						dataType: 'json',
						success: function(resp) {
							if (resp.code != null && resp.code == 200 && resp.data != null) {
								$('.shopping-cart-book-area').empty()
								var shopping_cart_num = 0
								var total_amount = 0
								$.each(resp.data, function(i, v) {
									shopping_cart_num++
									total_amount += v.amount * 10000
									html += 
										'<div class="cart-product">' +
											'<div class="cart-product-image">' +
										        '<a href="single-product.html?id=' + v.bookIdStr + '">' +
										            '<img src="' + v.book.picUrl + '" alt="" style="max-height: 100px;">' +
										        '</a>' +
										    '</div>' +
										    '<div class="cart-product-info">' +
										        '<p>' +
										            '<span>' + v.quantity + '</span>' +
										            'x' +
										            '<a href="single-product.html?id=' + v.bookIdStr + '">' + v.book.name + '</a>' +
										        '</p>' +
										        '<span class="cart-price">￥ ' + v.amount + '</span>' +
										    '</div>' +
										    '<div class="cart-product-remove" onClick="removeProduct(\'' + v.bookIdStr +'\')">' +
										        '<i class="fa fa-times"></i>' +
										    '</div>' +
										'</div>';
								})
								$('#shopping-cart-num').append('<span>' + shopping_cart_num + '</span>')
								$('.shopping-cart-book-area').html(html)
								$('.total-amount').html('￥&nbsp;' + (total_amount / 10000))
							} else {
								layer.msg(resp.msg)
							}
						},
						error: function(e) {
							if (e.responseJSON != null) {
								layer.msg(e.responseJSON.msg)
							} else {
								layer.msg('服务器未启动')
							}
						}
					})
				}
			}
			
			/**
			 * 移除购物车商品
			 */
			function removeProduct(bookId) {
				var userToken = window.localStorage.getItem('userToken')
				$.ajax({
					url: url.cart.deleteByBookId + "/" + bookId,
					headers: {
						token: userToken
					},
					type: 'DELETE',
					dataType: 'json',
					contentType: 'application/json',
					success: function(resp) {
						if (resp.code != null && resp.code == 200) {
							checkCart()
						} else {
							layer.msg(resp.msg)
						}
					},
					error: function(e) {
						if (e.responseJSON != null) {
							layer.msg(e.responseJSON.msg)
						} else {
							layer.msg('服务器未启动')
						}
					}
				})
			}
		</script>
</html>